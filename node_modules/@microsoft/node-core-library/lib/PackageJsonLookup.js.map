{"version":3,"sources":["PackageJsonLookup.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;AAE3D,0CAA0C;AAE1C,gCAAgC;AAChC,6BAA6B;AAC7B,yCAAsC;AAStC;;;;;GAKG;AACH;IASE;QACE,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAED;;;;OAIG;IACI,UAAU;QACf,IAAI,CAAC,mBAAmB,GAAG,IAAI,GAAG,EAA8B,CAAC;QACjE,IAAI,CAAC,iBAAiB,GAAG,IAAI,GAAG,EAAkB,CAAC;IACrD,CAAC;IAED;;;;;;;OAOG;IACI,mBAAmB,CAAC,cAAsB;QAC/C,iFAAiF;QACjF,wBAAwB;QACxB,EAAE,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YACjD,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QACtD,CAAC;QAED,IAAI,MAA0B,CAAC;QAE/B,MAAM,YAAY,GAAW,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;QAC1D,EAAE,CAAC,CAAC,CAAC,YAAY,IAAI,YAAY,KAAK,cAAc,CAAC,CAAC,CAAC;YACrD,MAAM,GAAG,SAAS,CAAC;QACrB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;YACnE,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;QACxC,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,MAAM,GAAG,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,CAAC;QAClD,CAAC;QAED,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;QACrD,MAAM,CAAC,MAAM,CAAC;IAChB,CAAC;IAED;;;;;;OAMG;IACI,cAAc,CAAC,eAAuB;QAC3C,IAAI,MAAM,GAAuB,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAC7E,EAAE,CAAC,CAAC,MAAM,KAAK,SAAS,CAAC,CAAC,CAAC;YACzB,MAAM,CAAC,MAAM,CAAC;QAChB,CAAC;QAED,MAAM,WAAW,GAAiB,mBAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,cAAc,CAAC,CAAiB,CAAC;QAC5G,MAAM,GAAG,WAAW,CAAC,IAAI,CAAC;QAE1B,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;QACpD,MAAM,CAAC,MAAM,CAAC;IAChB,CAAC;CACF;AAxED,8CAwEC","file":"PackageJsonLookup.js","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\n/* tslint:disable:no-constant-condition */\r\n\r\nimport * as fsx from 'fs-extra';\r\nimport * as path from 'path';\r\nimport { JsonFile } from './JsonFile';\r\n\r\n/**\r\n * Represents a package.json file.\r\n */\r\ninterface IPackageJson {\r\n  name: string;\r\n}\r\n\r\n/**\r\n * This class provides methods for finding the nearest \"package.json\" for a folder\r\n * and retrieving the name of the package.  The results are cached.\r\n *\r\n * @public\r\n */\r\nexport class PackageJsonLookup {\r\n  // Cached the return values for tryGetPackageFolder():\r\n  // sourceFilePath --> packageJsonFolder\r\n  private _packageFolderCache: Map<string, string | undefined>;\r\n\r\n  // Cached the return values for getPackageName():\r\n  // packageJsonPath --> packageName\r\n  private _packageNameCache: Map<string, string>;\r\n\r\n  constructor() {\r\n    this.clearCache();\r\n  }\r\n\r\n  /**\r\n   * Clears the internal file cache.\r\n   * @remarks\r\n   * Call this method if changes have been made to the package.json files on disk.\r\n   */\r\n  public clearCache(): void {\r\n    this._packageFolderCache = new Map<string, string | undefined>();\r\n    this._packageNameCache = new Map<string, string>();\r\n  }\r\n\r\n  /**\r\n   * Finds the path to the package folder of a given currentPath, by probing\r\n   * upwards from the currentPath until a package.json file is found.\r\n   * If no package.json can be found, undefined is returned.\r\n   *\r\n   * @param currentPath - a path (relative or absolute) of the current location\r\n   * @returns a relative path to the package folder\r\n   */\r\n  public tryGetPackageFolder(sourceFilePath: string): string | undefined {\r\n    // Two lookups are required, because get() cannot distinguish the undefined value\r\n    // versus a missing key.\r\n    if (this._packageFolderCache.has(sourceFilePath)) {\r\n      return this._packageFolderCache.get(sourceFilePath);\r\n    }\r\n\r\n    let result: string | undefined;\r\n\r\n    const parentFolder: string = path.dirname(sourceFilePath);\r\n    if (!parentFolder || parentFolder === sourceFilePath) {\r\n      result = undefined;\r\n    } else if (fsx.existsSync(path.join(parentFolder, 'package.json'))) {\r\n      result = path.normalize(parentFolder);\r\n    } else {\r\n      result = this.tryGetPackageFolder(parentFolder);\r\n    }\r\n\r\n    this._packageFolderCache.set(sourceFilePath, result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Loads the package.json file and returns the name of the package.\r\n   *\r\n   * @param packageJsonPath - an absolute path to the folder containing the\r\n   * package.json file, it does not include the 'package.json' suffix.\r\n   * @returns the name of the package (E.g. @microsoft/api-extractor)\r\n   */\r\n  public getPackageName(packageJsonPath: string): string {\r\n    let result: string | undefined = this._packageNameCache.get(packageJsonPath);\r\n    if (result !== undefined) {\r\n      return result;\r\n    }\r\n\r\n    const packageJson: IPackageJson = JsonFile.load(path.join(packageJsonPath, 'package.json')) as IPackageJson;\r\n    result = packageJson.name;\r\n\r\n    this._packageNameCache.set(packageJsonPath, result);\r\n    return result;\r\n  }\r\n}\r\n"],"sourceRoot":"..\\src"}