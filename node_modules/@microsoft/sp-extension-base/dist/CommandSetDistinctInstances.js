var CommandSetDistinctInstances = (function () {
    function CommandSetDistinctInstances(serverURL) {
        this._serverURL = serverURL;
        this._listName = 'TABTestFieldCustomizerList';
        this._commandItems = [];
    }
    CommandSetDistinctInstances.prototype.TestName = function () {
        return 'CommandSet: two instances of different CommandSets';
    };
    CommandSetDistinctInstances.prototype.TestOwner = function () {
        return 'dagaeta';
    };
    CommandSetDistinctInstances.prototype.TestIncludeScripts = function () {
        return [
            '<ProductScriptsLocation>msajaxbundle.debug.js',
            '<ProductScriptsLocation>sp.runtime.debug.js',
            '<ProductScriptsLocation>sp.debug.js',
            '<TestLocation>/TabTaskLib.debug.js',
            '<AzureTaskLibLocation>/sp-tab-tasklib.js'
        ];
    };
    CommandSetDistinctInstances.prototype.TestSetup = function () {
        TAB.Log.Comment('CommandSet test start');
        SPTaskLib.ExtensionUtil.loadList(this._listName);
    };
    CommandSetDistinctInstances.prototype.TestRun = function () {
        var customListPagePath = "/Lists/" + this._listName + "/AllItems.aspx";
        var customActionParams = '{' +
            '"1516565a-1785-4cb4-b339-79f104f88d22": {"location":"ClientSideExtension.ListViewCommandSet.CommandBar"},' +
            '"fd83646f-e2a7-4d7a-8423-85c69ec917fd": {"location":"ClientSideExtension.ListViewCommandSet.CommandBar"}' +
            '}';
        var azurePath = TAB.Settings.Get('AzurePath');
        var moduleLoader = azurePath + "/listview-host-assembly_en-us.js";
        var spQueryParams = {
            loadSPFX: true,
            customActions: customActionParams,
            debugManifestsFile: SPTaskLib.PageUtil.GetDebugManifestsUrl(),
            moduleloader: moduleLoader
        };
        var pageUrl = SPTaskLib.PageUtil.CreatePageUrl(customListPagePath, spQueryParams);
        TAB.AddTask(TAB.LoadPage(pageUrl));
        var listPageReady = TAB.MakeWaiter(function () {
            return TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link').length > 0;
        });
        SPTaskLib.PageUtil.AddTaskClearSecurityDialog(listPageReady);
        TAB.AddTask(TAB.MakeTask(function () {
            TAB.Log.Comment('Validating CommandSet items are set by the ' +
                'CommandSet extension (should be \'Command One\', \'Command Two\',' +
                '\'Command Dialog One\',\'Command Dialog Two\').');
        }), TAB.MakeWaiter(function () {
            var commandLinks = [];
            var queriedElements = TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link');
            Array.prototype.forEach.call(queriedElements, (function (value) {
                if (value.innerText.trim() === 'Command One' || value.innerText.trim() === 'Command Two'
                    || value.innerText.trim() === 'Command Dialog One' || value.innerText.trim() === 'Command Dialog Two') {
                    commandLinks.push(value);
                }
            }));
            return commandLinks.length === 4;
        }));
        TAB.AddTask(TAB.MakeTask(function () {
            var commandItems = TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link');
            var commandItemOne = undefined;
            var commandItemTwo = undefined;
            var commandDialogItemOne = undefined;
            var commandDialogItemTwo = undefined;
            for (var _i = 0, commandItems_1 = commandItems; _i < commandItems_1.length; _i++) {
                var commandItem = commandItems_1[_i];
                if (commandItem.innerText.trim() === 'Command One') {
                    commandItemOne = commandItem;
                }
                else if (commandItem.innerText.trim() === 'Command Two') {
                    commandItemTwo = commandItem;
                }
                else if (commandItem.innerText.trim() === 'Command Dialog One') {
                    commandDialogItemOne = commandItem;
                }
                else if (commandItem.innerText.trim() === 'Command Dialog Two') {
                    commandDialogItemTwo = commandItem;
                }
            }
            if (commandItemOne && commandItemTwo && commandDialogItemOne && commandDialogItemTwo) {
                SPTaskLib.ExtensionUtil.testCommandItem(commandItemOne, 'CommandOneDiv');
                SPTaskLib.ExtensionUtil.testCommandItem(commandItemTwo, 'CommandTwoDiv');
                SPTaskLib.ExtensionUtil.testDialogCommandItem(commandDialogItemOne, 'Clicked Command Dialog One');
                SPTaskLib.ExtensionUtil.testDialogCommandItem(commandDialogItemTwo, 'Clicked Command Dialog Two. Enter something to alert:');
            }
            else {
                TAB.Log.AddTaskFail('Two distinct Command Set items not functioning properly, missing a Command item.');
            }
        }));
        TAB.Log.AddTaskPass('Test complete');
    };
    return CommandSetDistinctInstances;
}());
TabTest = CommandSetDistinctInstances;
