import * as Gulp from 'gulp';
import { JSONSchema4 } from 'json-schema';
import { ServeTask, IServeTaskConfig } from '@microsoft/gulp-core-build-serve/lib/ServeTask';
import { ISpfxServeSessionConfiguration } from './ISpfxServe';
export interface ISpfxServeTaskConfig extends IServeTaskConfig {
    serveConfigurations?: {
        default: ISpfxServeSessionConfiguration;
        [id: string]: ISpfxServeSessionConfiguration;
    };
}
export declare const DEBUG_MANIFESTS_QUERY_PARAMETER: string;
export declare class SpfxServeTask extends ServeTask<ISpfxServeTaskConfig> {
    private _defaultInitialPage;
    constructor();
    executeTask(gulp: typeof Gulp, completeCallback: (error?: string) => void): void;
    loadSchema(): JSONSchema4;
    protected _getConfigFilePath(): string;
    private _convertServeConfigurationToPageUrl(serveConfiguration);
    private _getBaseServeUrl();
    /**
     * Workaround for loading gulp-connect, which automatically uses http2 if it
     * can require() a module called 'http2'
     *
     * https://github.com/AveVlad/gulp-connect/issues/246
     *
     * In versions of NodeJS < 8:
     *   'http2' would have to be a module in the node_modules folder.
     *   We did not provide this normally, so most of the time nobody used http2 with gulp serve.
     *
     * However, in versions of NodeJS >= 8:
     *   They provide a built-in module called 'http2', which is experimental and unstable
     *   The built-in module is preferred unless an environment variable is set: NODE_NO_HTTP2=1
     *
     * We don't want to enforce environmental requirements, nor
     * do we want to support a toolchain that relies on an experimental API.
     *
     * Until gulp-connect provides a way to disable HTTP2, we're using this workaround:
     * Inject a falsey value into the require() cache, require gulp-connect,
     * then restore the old cache state.
     *
     * As a consequence, this approach will prevent "gulp-connect" from using http2 in
     * environments with Node < 8. This is intentional, because we don't see a reason to
     * support http2 for serving localhost scripts.
     */
    private _loadGulpConnect();
}
