{"version":3,"file":"ScrollablePane.js","sourceRoot":"../src/","sources":["components/ScrollablePane/ScrollablePane.tsx"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:no-unused-variable */\r\nimport * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\n/* tslint:enable:no-unused-variable */\r\nimport * as PropTypes from 'prop-types';\r\nimport {\r\n  autobind,\r\n  BaseComponent,\r\n  css\r\n} from '../../Utilities';\r\nimport { IScrollablePane, IScrollablePaneProps } from './ScrollablePane.Props';\r\nimport { Sticky } from '../../Sticky';\r\nimport * as stylesImport from './ScrollablePane.scss';\r\nconst styles: any = stylesImport;\r\n\r\nexport interface IScrollablePaneContext {\r\n  scrollablePane: PropTypes.Requireable<object>;\r\n}\r\n\r\nexport class ScrollablePane extends BaseComponent<IScrollablePaneProps, {}> implements IScrollablePane {\r\n  public static childContextTypes: IScrollablePaneContext = {\r\n    scrollablePane: PropTypes.object\r\n  };\r\n\r\n  public refs: {\r\n    root: HTMLElement;\r\n    stickyContainer: HTMLElement;\r\n    stickyAbove: HTMLElement;\r\n    stickyBelow: HTMLElement;\r\n  };\r\n\r\n  private _subscribers: Set<Function>;\r\n  private _stickyAbove: Set<Sticky>;\r\n  private _stickyBelow: Set<Sticky>;\r\n\r\n  constructor(props: IScrollablePaneProps) {\r\n    super(props);\r\n    this._subscribers = new Set<Function>();\r\n    this._stickyAbove = new Set<Sticky>();\r\n    this._stickyBelow = new Set<Sticky>();\r\n  }\r\n\r\n  public getChildContext() {\r\n    return {\r\n      scrollablePane: {\r\n        subscribe: this.subscribe,\r\n        unsubscribe: this.unsubscribe,\r\n        addStickyHeader: this.addStickyHeader,\r\n        removeStickyHeader: this.removeStickyHeader,\r\n        addStickyFooter: this.addStickyFooter,\r\n        removeStickyFooter: this.removeStickyFooter,\r\n        notifySubscribers: this.notifySubscribers\r\n      }\r\n    };\r\n  }\r\n\r\n  public componentDidMount() {\r\n    const { root, stickyContainer } = this.refs;\r\n\r\n    this._events.on(root, 'scroll', this.notifySubscribers);\r\n    this._events.on(window, 'resize', this._onWindowResize);\r\n    setTimeout(() => {\r\n      this._resizeContainer();\r\n      if (stickyContainer.parentElement && root.parentElement) {\r\n        stickyContainer.parentElement.removeChild(stickyContainer);\r\n        root.parentElement.insertBefore(stickyContainer, root.nextSibling);\r\n        this.notifySubscribers();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    const { stickyContainer } = this.refs;\r\n    this._events.off(this.refs.root);\r\n    this._events.off(window);\r\n    if (stickyContainer.parentElement) {\r\n      stickyContainer.parentElement.removeChild(stickyContainer);\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    const { className } = this.props;\r\n\r\n    return (\r\n      <div\r\n        ref='root'\r\n        className={ css('ms-ScrollablePane', styles.root, className) }\r\n        data-is-scrollable={ true }\r\n      >\r\n        <div ref='stickyContainer' className={ styles.stickyContainer }>\r\n          <div ref='stickyAbove' className={ styles.stickyAbove } />\r\n          <div ref='stickyBelow' className={ styles.stickyBelow } />\r\n        </div>\r\n        { this.props.children }\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public forceLayoutUpdate() {\r\n    this._onWindowResize();\r\n  }\r\n\r\n  @autobind\r\n  public subscribe(handler: (headerBound: ClientRect, footerBound: ClientRect) => void) {\r\n    this._subscribers.add(handler);\r\n  }\r\n\r\n  @autobind\r\n  public unsubscribe(handler: (headerBound: ClientRect, footerBound: ClientRect) => void) {\r\n    this._subscribers.delete(handler);\r\n  }\r\n\r\n  @autobind\r\n  public addStickyHeader(sticky: Sticky) {\r\n    const { stickyAbove } = this.refs;\r\n    this._addSticky(sticky, this._stickyAbove, stickyAbove, () => {\r\n      stickyAbove.appendChild(sticky.content);\r\n    });\r\n  }\r\n\r\n  @autobind\r\n  public addStickyFooter(sticky: Sticky) {\r\n    const { stickyBelow } = this.refs;\r\n    this._addSticky(sticky, this._stickyBelow, stickyBelow, () => {\r\n      stickyBelow.insertBefore(sticky.content, stickyBelow.firstChild);\r\n    });\r\n  }\r\n\r\n  @autobind\r\n  public removeStickyHeader(sticky: Sticky) {\r\n    this._removeSticky(sticky, this._stickyAbove, this.refs.stickyAbove);\r\n  }\r\n\r\n  @autobind\r\n  public removeStickyFooter(sticky: Sticky) {\r\n    this._removeSticky(sticky, this._stickyBelow, this.refs.stickyBelow);\r\n  }\r\n\r\n  @autobind\r\n  public notifySubscribers(sort?: boolean): void {\r\n    const { stickyAbove, stickyBelow } = this.refs;\r\n    this._subscribers.forEach((handle) => {\r\n      handle(stickyAbove.getBoundingClientRect(), stickyBelow.getBoundingClientRect());\r\n    });\r\n    if (this._stickyAbove.size > 1) {\r\n      this._sortStickies(this._stickyAbove, stickyAbove);\r\n    }\r\n    if (this._stickyBelow.size > 1) {\r\n      this._sortStickies(this._stickyBelow, stickyBelow);\r\n    }\r\n  }\r\n\r\n  private _addSticky(sticky: Sticky, stickyList: Set<Sticky>, container: HTMLElement, addStickyToContainer: () => void) {\r\n    if (!stickyList.has(sticky)) {\r\n      stickyList.add(sticky);\r\n      addStickyToContainer();\r\n      sticky.content.addEventListener('transitionend',\r\n        this._setPlaceholderHeights.bind(null, stickyList),\r\n        false);\r\n      if (sticky.props.stickyClassName) {\r\n        setTimeout(() => {\r\n          if (sticky.props.stickyClassName) {\r\n            sticky.content.children[0].classList.add(sticky.props.stickyClassName);\r\n          }\r\n        }, 1);\r\n      }\r\n      this.notifySubscribers();\r\n      this._setPlaceholderHeights(stickyList);\r\n    }\r\n  }\r\n\r\n  private _removeSticky(sticky: Sticky, stickyList: Set<Sticky>, container: HTMLElement) {\r\n    if (stickyList.has(sticky)) {\r\n      sticky.content.removeEventListener('transitionend',\r\n        this._setPlaceholderHeights.bind(null, stickyList, container));\r\n      stickyList.delete(sticky);\r\n    }\r\n  }\r\n\r\n  private _onWindowResize() {\r\n    setTimeout(() => {\r\n      this._resizeContainer();\r\n      this.notifySubscribers();\r\n      this._setPlaceholderHeights(this._stickyAbove);\r\n      this._setPlaceholderHeights(this._stickyBelow);\r\n    }, 5);\r\n  }\r\n\r\n  private _resizeContainer() {\r\n    const { stickyContainer, root } = this.refs;\r\n    const { borderTopWidth, borderLeftWidth } = getComputedStyle(root);\r\n    stickyContainer.style.height = root.clientHeight + 'px';\r\n    stickyContainer.style.width = root.clientWidth + 'px';\r\n    if (borderTopWidth) {\r\n      stickyContainer.style.top = root.offsetTop + parseInt(borderTopWidth, 10) + 'px';\r\n    }\r\n    if (borderLeftWidth) {\r\n      stickyContainer.style.left = root.offsetLeft + parseInt(borderLeftWidth, 10) + 'px';\r\n    }\r\n  }\r\n\r\n  @autobind\r\n  private _setPlaceholderHeights(stickies: Set<Sticky>) {\r\n    stickies.forEach((sticky, idx) => {\r\n      sticky.setPlaceholderHeight(sticky.content.clientHeight);\r\n    });\r\n  }\r\n\r\n  private _sortStickies(stickyList: Set<Sticky>, container: HTMLElement): void {\r\n    let stickyArr = Array.from(stickyList);\r\n    stickyArr = stickyArr.sort((a, b) => {\r\n      return a.refs.root.offsetTop - b.refs.root.offsetTop;\r\n    });\r\n    while (container.lastChild) {\r\n      container.removeChild(container.lastChild);\r\n    }\r\n    stickyArr.forEach((sticky) => {\r\n      container.appendChild(sticky.content);\r\n    });\r\n  }\r\n}"]}